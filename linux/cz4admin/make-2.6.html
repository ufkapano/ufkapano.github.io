<html>
<head>
<title>Kompilacja j±dra 2.6 ze ¼róde³</title>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2">
</head>

<body bgcolor="white" text="black" link="blue" vlink="navy" alink="red">

<h1>Kompilacja j±dra 2.6 ze ¼róde³</h1>

<h3>INFORMACJE</h3>

<ul>
<li>Chip Special Linux Wiosna 2001 - 
s. 64 (konfiguracja j±dra),
s. 68 (kompilacja j±dra)
</ul>

<h3>PAKIETY</h3>

<p>gcc, libc6-dev, bin86, 
ncurses-dev (dla menuconfig),
tk-dev (dla xconfig),
fakeroot (je¿eli kompilujemy jako zwyk³y u¿ytkownik),
kernel-package,

<p>Dawniej wszystko robi³em jako root. Niektórzy pisz±, ¿eby
pracowaæ jako zwyk³y u¿ytkownik i chyba dopiero na etapie
instalacji kernela wykonaæ sudo.

<h3>KROK 1</h3>

<p>Bedê kompilowa³ przyk³adowe j±dro 2.6 w Debianie.
Zwykle mamy ju¿ katalog ze ¼rod³ami starego j±dra o nazwie
<em>/usr/src/linux</em>. Je¿eli to jest link symboliczny, to go usuwamy.
Je¿eli to jest prawdziwy katalog, to nazywamy go zgodnie z wersj±
j±dra, np. poleceniem
<br>
[root]# mv /usr/src/linux /usr/src/linux-2.6.x

<h3>KROK 2</h3>

<p>Przechodzimy do w³a¶ciwego katalogu
<br>
[root]# cd /usr/src

<h3>KROK 3</h3>

<p>Je¿eli mamy ¼ród³a na dysku w katalogu <em>/usr/src</em>, 
to rozpakowujemy
<br>
[root]# tar -xzvf linux-2.6.x.tar.gz
<br>
lub
<pre>
[root]# bzip2 -d linux-2.6.x.tar.bz2
[root]# tar -xvf linux-2.6.x.tar
</pre>

<p>Mo¿na zmieniæ w³a¶ciciela drzewa plików ze ¼ród³ami

<pre>
[root]# chown -R root:root /usr/src/linux
[root]# chown -R root:src /usr/src/linux
</pre>

<h3>KROK 4</h3>

<p>Postêpujemy wg pliku README. 
Pisz±, aby nie u¿ywaæ katalogu <em>/usr/src/linux</em> do kompilacji!
Ja jednak zostawiam tutaj.
W Documentation/Changes trzeba sprawdziæ potrzebne wersje pakietów.

<h3>KROK 5</h3>

<pre>
[root]# cd /usr/src/linux
[root]# make mrproper            (generalne porzadki)
</pre>

<p>To polecenie kasuje plik <em>.config</em>, 
wiêc lepiej go gdzie¶ skopiowaæ.

<h3>KROK 6</h3>

<p>Konfigurujemy j±dro za pomoc± jednego z narzêdzi:

<pre>
make config                (tekstowy, uci±¿liwe pytania)
make menuconfig            (semigraficzny)
make xconfig               (do X Window)
make oldconfig    
(aby korzysta³ ze starego .config, z poprzedniej wersji kernela)
</pre>

<p>Wybieram:
<br>
[root]# make menuconfig

<p>Warto mieæ pod rêka Kernel-HOWTO.
Warto zapisaæ ustawienia do pliku 
(.config lub z nasz± nazw± config-2.6.x).

<h3>KROK 6</h3>

<p>Dawniej robi³em:
<pre>
[root]# make dep             (obecnie nie trzeba)
[root]# make clean           (czyszczenie po ostatniej kompilacji)
[root]# make bzImage          (w³a¶ciwa kompilacja j±dra)
</pre>

<p>Samo j±dro podpowiada "make" lub "make help". Zrobiê:

<pre>
[root]# make clean           (nie skasuje .config)
[root]# make all          (powstaje bzImage)
</pre>

<p>Skompilowane j±dro jest umieszczane w pliku
<em>/usr/src/linux/arch/i386/boot/bzImage</em>.

<h3>KROK 7</h3>

<pre>
[root]# make modules                 (kompilacja modu³ów j±dra)
[root]# make modules_install            (instalacja modu³ów)
</pre>

<h3>KROK 8</h3>

<p>Kopiujemy j±dro w odpowiednie miejsce zmieniaj±c nazwê

<pre>
[root]# cd /usr/src/linux/arch/i386/boot
[root]# cp bzImage /boot/vmlinuz-2.6.x
</pre>

<h3>KROK 9</h3>

<p>
Instalujemy mapê systemow± j±dra, czyli plik z adresami funkcji
zdefiniowanych w kernelu.
<br>
[root]# cp /usr/src/linux/System.map /boot/System.map-2.6.x

<p>Tworzymy plik <em>initrd.img</em> (to jest chyba krok opcjonalny)
<br>
[root]# mkinitrd -o /boot/initrd.img-2.6.x /lib/modules/2.6.x

<h3>KROK 10</h3>

<p>
Modyfikujemy plik <em>/etc/lilo.conf</em> dodaj±c now± sekcjê 
<em>image</em> i uaktualniamy konfiguracjê LILO poleceniem
<br>
[root]# lilo

<p>Prze³adowujemy system
<br>
[root]# reboot

</body>
</html>
