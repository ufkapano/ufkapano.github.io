<html>
<head>
<title>Python</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
</head>

<body bgcolor="white" text="black" link="blue" vlink="navy" alink="red">

<h1>Moduł unittest</h1>

<p>https://docs.python.org/3/library/unittest.html

<h3>WPROWADZENIE</h3>

<p>Moduł wspiera automatyzację testów, grupowanie testów w kolekcje,
niezależność testów od narzędzi raportuących wyniki testów (reporting frameworks).
Moduł dostarcza klasy, które ułatwiają te zadania.
Ważne pojęcia:

<ul>
<li>test fixture - reprezentuje przygotowania potrzebne do przeprowadzenia
testów, różne akcje czyszczące.
<li>test case - najmniejsza jednostka testowania, 
sprawdza konkretny wynik dla danego wejścia.
<li>test suite - kolekcja test cases lub test suites.
<li>test runner - zarządza testami i prezentuje wyniki użytkownikowi.
</ul>

<p>Testy tworzymy w klasach wywiedzionych z unittest.TestCase.
Jednostką testowania (test case) jest metoda bez parametrów,
o nazwie rozpoczynającej się od "test", 
która ma sprawdzać jedną konkretną rzecz dotyczącą kodu.
Test ma być przeprowadzony automatycznie, ma być niezależny
od innych testów, a wynik ma być automatycznie zinterpretowany.

<p>Testy mogą być grupowane w zestawach (test suits),
typowy zestaw tworzą metody z jednej klasy wywiedzionej z unittest.TestCase.


<p>Poniżej mamy przykład prostego modułu zawierającego funkcję
average() do obliczania średniej arytmetycznej listy liczb.
Kod testujący funkcję został umieszczony w tym samym module.
Kod testujący zostanie wykonany, jeżeli moduł zostanie uruchomiony
jako moduł główny.

<p>W praktyce kod testujący moduł zwykle umieszcza się w osobnym pliku.
Testy dla modułu <em>spam.py</em> umieszcza się w pliku <em>test_spam.py</em>.
Często testy (pliki <em>test_*.py</em>) umieszcza się w osobnym
katalogu tests.

<hr><pre>
import unittest

def average(values):
    """Oblicza średnią arytmetyczną listy liczb."""
    return sum(values, 0.0) / len(values)

# testcase tworzymy przez dziedziczenie z unittest.TestCase.
# Kolejne testy to metody w klasie o nazwach zaczynających się
# od "test" (to jest konwencja dla test runnera).
# W każdej metodzie kluczowe jest zastosowanie funkcji:

# assertEqual(first, second, msg=None)
# - sprawdzanie wyniku,
# msg to komunikat do wypisania przy wystąpieniu błędu;
# assertEqual(expression_to_test, expected_result)   # typowa kolejność

# assertAlmostEqual(first, second, places=7, msg=None)
# - sprawdzanie wyniku typu float z domyślną dokładnością 7 cyfr;

# assertNotEqual(first, second, msg=None)
# - sprawdzanie wyniku;

# assertNotAlmostEqual(first, second, places=7, msg=None)
# - sprawdzanie wyniku;

# assertTrue(expr, msg=None)
# - sprawdzanie wartości logicznej;

# assertFalse(expr, msg=None)
# - sprawdzanie wartości logicznej;

# assertRaises(exception, callable, ...)
# - sprawdzenie wystąpienia spodziewanego wyjątku;

# assertRaises(exception, func, *args, **keywords) 
# - sprawdzenie wyjątku func(*args, **keywords)

class TestStatisticalFunctions(unittest.TestCase):

    # Można określić czynności przygotowawcze.
    def setUp(self): pass

    # Dla poprawnych danych wejściowych nie ma prawa pojawić się wyjątek.
    def test_average_good(self):
        # Nie wstawiamy docstringu.
        self.assertEqual(average([20, 30, 70]), 40.0)
        self.assertEqual(round(average([1, 5, 7]), 1), 4.3)

    # Nieprawidłowe dane powinny generować konkretny wyjątek.
    def test_average_bad(self):
        # Nie wstawiamy docstringu.
        self.assertRaises(ZeroDivisionError, average, [])
        self.assertRaises(TypeError, average, 20, 30, 70)

    # Końcowe czynności czyszczące.
    def tearDown(self): pass

# Załóżmy, że mamy w danym module zdefiniowane inne funkcje.
# Przygotowujemy nową klasę do testowania tych funkcji.

class TestOtherFunctions(unittest.TestCase):

    def test_other(self):
        pass

# Prosty sposób uruchomienia wszystkich testów z obu klas
# TestStatisticalFunctions i TestOtherFunctions.

if __name__ == '__main__':
    unittest.main()     # włącza wszystkie testy
    #unittest.main(verbosity=2)    # Python 2.7, więcej informacji

# Jeżeli powyższy kod umieścimy w module 'average.py', to polecenie
# python3 average.py -v
# wyświetli szczegółowe informacje o testach.
</pre><hr><pre>
# Zakładamy, że istnieje tylko klasa TestStatisticalFunctions.
# Uruchomienie testów, przy którym dostajemy więcej informacji.
# Mamy możliwość wyboru testów.

if __name__ == '__main__':
    suite = unittest.TestLoader().loadTestsFromTestCase(TestStatisticalFunctions)
    unittest.TextTestRunner(verbosity=2).run(suite)
</pre><hr><pre>
# Przy wielu klasach z testami możemy wybierać, z których klas
# mają pochodzić testy.

if __name__ == '__main__':
    suite1 = unittest.TestLoader().loadTestsFromTestCase(TestStatisticalFunctions)
    suite2 = unittest.TestLoader().loadTestsFromTestCase(TestOtherFunctions)
    #suite = unittest.TestSuite([suite1, suite2])  # wszystkie testy
    suite = unittest.TestSuite([suite2])           # wybrany zestaw testów
    unittest.TextTestRunner(verbosity=2).run(suite)
</pre><hr><pre>
# Możemy ręcznie wstawiać nazwy testów do zestawu.

if __name__ == '__main__':
    suite = unittest.TestSuite()    # pusty zestaw testów
    suite.addTest(TestStatisticalFunctions("test_average_good"))
    unittest.TextTestRunner(verbosity=2).run(suite)
</pre><hr><pre>
# Przykład z książki Turnquista.
# Zakładamy, że istnieje tylko klasa TestStatisticalFunctions.
# Nazwy testów podajemy w wierszu poleceń:
# python skrypt.py test_name1 test_name2 ...

if __name__ == '__main__':
    import sys
    suite = unittest.TestSuite()
    if len(sys.argv) == 1:
        suite = unittest.TestLoader().loadTestsFromTestCase(
            TestStatisticalFunctions)
    else:
        for test_name in sys.argv[1:]:
            suite.addTest(TestStatisticalFunctions(test_name))
    unittest.TextTestRunner(verbosity=2).run(suite)
</pre><hr>

<p>Przykład tworzenia testów dla funkcji konwertujących liczby
zapisane w systemie rzymskim można znaleźć w książce
Marka Pilgrima <em>Dive Into Python</em>, 
dostępną za darmo pod adresem
<em>http://www.diveintopython.net/</em>.


</body>
</html>
